---
layout: post
title: 使用python进行ClustalW格式和aligned FASTA格式转换
tags:
- bioinformatics
- programming
- python
- sequence alignment
- study
status: publish
type: post
published: true
meta:
  _searchme: '1'
  views: '1636'
---
ClustalW格式是多序列比对程序CLUSTAL W的默认输出格式，大概是这个样子：

<a href="http://azaleasays.com/wp-content/uploads/2010/07/clw.jpg"><img src="http://azaleasays.com/wp-content/uploads/2010/07/clw.jpg" alt="" width="557" height="368" /></a>

Aligned FASTA格式是多序列比对程序MUSCLE的默认输出格式，与一般的FASTA格式很相似，只是根据比对结果在序列中填充“-”，使所有序列长度相同，例如：

<a href="http://azaleasays.files.wordpress.com/2008/06/afa.jpg"><img src="http://azaleasays.files.wordpress.com/2008/06/afa.jpg" alt="" width="538" height="277" /></a>

Aligned FASTA格式更便于机器阅读，而ClustalW格式是比较人性化的 ，使用者可以直观地看到相同和不同的区域。

由于MUSCLE程序的profile alignment功能需要aligned FASTA格式的输入，因此我写了以下一段简单的python代码，把ClustalW格式转换成aligned FASTA格式：

     <div style="font-family:&quot;" class="source"><span style="color:rgb(0,136,0);font-style:italic;" class="lineno"></span> <span style="color:rgb(0,136,0);font-style:italic;">#!/usr/bin/python</span><br /><span style="color:rgb(0,136,0);font-style:italic;" class="lineno"></span> <span style="color:rgb(0,136,0);font-style:italic;">#Usage: python clw2afa.py input.clw</span><br /><span style="color:rgb(0,136,0);font-style:italic;" class="lineno"></span> <span style="color:rgb(0,136,0);font-style:italic;">#Default output is STDOUT, you can redirect using &#039;&gt;&#039;</span><br /><span style="color:rgb(0,136,0);font-style:italic;" class="lineno"></span> <span style="color:rgb(0,136,0);font-style:italic;">#You can also import it as a module, i.e. import clw2afa</span><br /><span class="lineno special"></span> <br /><span style="color:rgb(0,136,0);font-style:italic;" class="lineno"></span> import sys<br /><span style="color:rgb(0,136,0);font-style:italic;" class="lineno"></span> import re<br /><span style="color:rgb(0,136,0);font-style:italic;" class="lineno"></span> <br /><span style="color:rgb(0,136,0);font-style:italic;" class="lineno"></span> <span style="color:rgb(0,0,128);font-weight:bold;">def</span> clw2afa(filename):<br /><span class="lineno special"></span> &nbsp;&nbsp;&nbsp; pat=re.compile(<span style="color:rgb(0,0,255);">&#039;(S+)s+(S+)&#039;</span>)<br /><span style="color:rgb(0,136,0);font-style:italic;" class="lineno"></span> &nbsp;&nbsp;&nbsp; f=open(filename)<br /><span style="color:rgb(0,136,0);font-style:italic;" class="lineno"></span> &nbsp;&nbsp;&nbsp; header=f.readline()<br /><span style="color:rgb(0,136,0);font-style:italic;" class="lineno"></span> &nbsp;&nbsp;&nbsp; <span style="color:rgb(0,0,128);font-weight:bold;">if</span> <span style="font-weight:bold;">not</span> header.startswith(<span style="color:rgb(0,0,255);">&#039;CLUSTAL&#039;</span>) <span style="font-weight:bold;">and</span> <span style="font-weight:bold;">not</span> header.startswith(<span style="color:rgb(0,0,255);">&#039;MUSCLE&#039;</span>):<br /><span style="color:rgb(0,136,0);font-style:italic;" class="lineno"></span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sys.exit(<span style="color:rgb(0,0,255);">&quot;clw2afa.py:Wrong input file type.&quot;</span>)<br /><span class="lineno special"></span> &nbsp;&nbsp;&nbsp; ln=f.readline()<br /><span style="color:rgb(0,136,0);font-style:italic;" class="lineno"></span> &nbsp;&nbsp;&nbsp; <span style="color:rgb(0,0,128);font-weight:bold;">while</span> <span style="font-weight:bold;">not</span> ln.strip():<br /><span style="color:rgb(0,136,0);font-style:italic;" class="lineno"></span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ln=f.readline()<br /><span style="color:rgb(0,136,0);font-style:italic;" class="lineno"></span> &nbsp;&nbsp;&nbsp; seqdict={}<br /><span style="color:rgb(0,136,0);font-style:italic;" class="lineno"></span> &nbsp;&nbsp;&nbsp; EOF=False<br /><span class="lineno special"></span> &nbsp;&nbsp;&nbsp; <span style="color:rgb(0,0,128);font-weight:bold;">while</span> ln:<br /><span style="color:rgb(0,136,0);font-style:italic;" class="lineno"></span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; m=pat.search(ln)&nbsp;&nbsp; <br /><span style="color:rgb(0,136,0);font-style:italic;" class="lineno"></span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:rgb(0,0,128);font-weight:bold;">if</span> m <span style="font-weight:bold;">and</span> <span style="font-weight:bold;">not</span> <span style="color:rgb(0,0,255);">&#039;*&#039;</span> <span style="font-weight:bold;">in</span> ln: <br /><span style="color:rgb(0,136,0);font-style:italic;" class="lineno"></span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; seqdict[m.group(<span style="color:rgb(0,0,255);">1</span>)]=m.group(<span style="color:rgb(0,0,255);">2</span>)<br /><span style="color:rgb(0,136,0);font-style:italic;" class="lineno"></span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ln=f.readline()<br /><span class="lineno special"></span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:rgb(0,0,128);font-weight:bold;">elif</span> <span style="font-weight:bold;">not</span> ln:<br /><span style="color:rgb(0,136,0);font-style:italic;" class="lineno"></span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; EOF=True<br /><span style="color:rgb(0,136,0);font-style:italic;" class="lineno"></span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:rgb(0,0,128);font-weight:bold;">break</span><br /><span style="color:rgb(0,136,0);font-style:italic;" class="lineno"></span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:rgb(0,0,128);font-weight:bold;">else</span>:<br /><span style="color:rgb(0,136,0);font-style:italic;" class="lineno"></span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:rgb(0,0,128);font-weight:bold;">break</span><br /><span class="lineno special"></span> &nbsp;&nbsp;&nbsp; <span style="color:rgb(0,0,128);font-weight:bold;">if</span> <span style="font-weight:bold;">not</span> EOF:<br /><span style="color:rgb(0,136,0);font-style:italic;" class="lineno"></span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:rgb(0,0,128);font-weight:bold;">while</span> True:<br /><span style="color:rgb(0,136,0);font-style:italic;" class="lineno"></span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ln=f.readline()<br /><span style="color:rgb(0,136,0);font-style:italic;" class="lineno"></span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:rgb(0,0,128);font-weight:bold;">if</span> <span style="font-weight:bold;">not</span> ln:<br /><span style="color:rgb(0,136,0);font-style:italic;" class="lineno"></span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:rgb(0,0,128);font-weight:bold;">break</span><br /><span class="lineno special"></span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; m=pat.search(ln)<br /><span style="color:rgb(0,136,0);font-style:italic;" class="lineno"></span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:rgb(0,0,128);font-weight:bold;">if</span> m <span style="font-weight:bold;">and</span> <span style="font-weight:bold;">not</span> <span style="color:rgb(0,0,255);">&#039;*&#039;</span> <span style="font-weight:bold;">in</span> ln:<br /><span style="color:rgb(0,136,0);font-style:italic;" class="lineno"></span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; seqdict[m.group(<span style="color:rgb(0,0,255);">1</span>)]+=<span style="color:rgb(0,0,255);">&#039;</span><span style="color:rgb(0,0,255);">n</span><span style="color:rgb(0,0,255);">&#039;</span>+m.group(<span style="color:rgb(0,0,255);">2</span>)<br /><span style="color:rgb(0,136,0);font-style:italic;" class="lineno"></span> &nbsp;&nbsp;&nbsp; f.close()<br /><span style="color:rgb(0,136,0);font-style:italic;" class="lineno"></span> &nbsp;&nbsp;&nbsp; output=<span style="color:rgb(0,0,255);">&#039;&#039;</span><br /><span class="lineno special"></span> &nbsp;&nbsp;&nbsp; <span style="color:rgb(0,0,128);font-weight:bold;">for</span> k,v <span style="font-weight:bold;">in</span> seqdict.items():<br /><span style="color:rgb(0,136,0);font-style:italic;" class="lineno"></span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; output+=<span style="color:rgb(0,0,255);">&#039;&gt;</span><span style="color:rgb(0,0,255);">%s</span><span style="color:rgb(0,0,255);">n</span><span style="color:rgb(0,0,255);">%s</span><span style="color:rgb(0,0,255);">n</span><span style="color:rgb(0,0,255);">&#039;</span>%(k,v)<br /><span style="color:rgb(0,136,0);font-style:italic;" class="lineno"></span> &nbsp;&nbsp;&nbsp; <span style="color:rgb(0,0,128);font-weight:bold;">return</span> output<br /><span style="color:rgb(0,136,0);font-style:italic;" class="lineno"></span> <br /><span style="color:rgb(0,136,0);font-style:italic;" class="lineno"></span> <span style="color:rgb(0,0,128);font-weight:bold;">if</span> __name__ == <span style="color:rgb(0,0,255);">&quot;__main__&quot;</span>:<br /><span class="lineno special"></span> &nbsp;&nbsp;&nbsp; import sys<br /><span style="color:rgb(0,136,0);font-style:italic;" class="lineno"></span> &nbsp;&nbsp;&nbsp; tt=clw2afa(sys.argv[<span style="color:rgb(0,0,255);">1</span>])<br /><span style="color:rgb(0,136,0);font-style:italic;" class="lineno"></span> &nbsp;&nbsp;&nbsp; <span style="color:rgb(0,0,128);font-weight:bold;">print</span> tt<br /></div>

写得有点混乱，希望大家如果使用的话把BUG报告一下^^
